<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>채팅 테스트 페이지</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .message-bubble {
            max-width: 70%;
            word-wrap: break-word;
        }
        .message-sent {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 18px 18px 4px 18px;
        }
        .message-received {
            background: #f1f5f9;
            color: #1e293b;
            border-radius: 18px 18px 18px 4px;
        }
        .typing-indicator {
            display: none;
        }
        .typing-indicator.show {
            display: flex;
        }
        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #9ca3af;
            animation: typing 1.4s infinite ease-in-out;
        }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes typing {
            0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }
        .room-card {
            transition: all 0.3s ease;
        }
        .room-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        .member-online {
            position: relative;
        }
        .member-online::after {
            content: '';
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 12px;
            height: 12px;
            background-color: #10b981;
            border: 2px solid white;
            border-radius: 50%;
        }
    </style>
</head>
<body class="min-h-screen bg-gray-100">
    <!-- Header -->
    <header class="bg-white shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-6">
                <div class="flex items-center">
                    <a href="/" class="text-2xl font-bold text-gray-900 hover:text-blue-600">← Intune Chat</a>
                </div>
                <nav class="flex space-x-4">
                    <a href="/" class="text-gray-600 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium">
                        홈으로
                    </a>
                    <a href="/simple-test.html" class="text-gray-600 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium">
                        간단한 테스트
                    </a>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <h1 class="text-3xl font-bold text-center mb-8 text-gray-800">
            💬 채팅 시스템 테스트
        </h1>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
            <!-- 채팅방 목록 -->
            <div class="lg:col-span-1 bg-white rounded-lg shadow-md p-4">
                <h2 class="text-xl font-semibold mb-4 text-gray-700">채팅방 목록</h2>
                <div class="space-y-2" id="room-list">
                    <!-- 채팅방들이 여기에 동적으로 추가됩니다 -->
                </div>
            </div>

            <!-- 채팅 메시지 영역 -->
            <div class="lg:col-span-2 bg-white rounded-lg shadow-md flex flex-col h-96">
                <div id="chat-container">
                    <!-- 채팅방 헤더 -->
                    <div class="p-4 border-b border-gray-200" id="chat-header" style="display: none;">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 rounded-full bg-blue-500 flex items-center justify-center text-white font-semibold" id="room-avatar">
                                    💬
                                </div>
                                <div>
                                    <h3 class="font-semibold text-gray-900" id="room-name">
                                        채팅방 이름
                                    </h3>
                                    <p class="text-sm text-gray-500" id="room-info">
                                        0명 참여 중
                                    </p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800" id="room-type">
                                    개인
                                </span>
                            </div>
                        </div>
                    </div>

                    <!-- 메시지 목록 -->
                    <div class="flex-1 overflow-y-auto p-4 space-y-4" id="messages-container">
                        <div class="text-center text-gray-500 py-8">
                            채팅방을 선택해주세요
                        </div>
                    </div>

                    <!-- 메시지 입력 -->
                    <div class="p-4 border-t border-gray-200" id="message-input" style="display: none;">
                        <div class="flex space-x-2">
                            <select id="message-type" class="px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                <option value="text">텍스트</option>
                                <option value="image">이미지</option>
                                <option value="file">파일</option>
                                <option value="system">시스템</option>
                                <option value="bot">봇</option>
                            </select>
                            <input
                                type="text"
                                id="message-text"
                                placeholder="메시지를 입력하세요..."
                                class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                            />
                            <button
                                onclick="sendMessage()"
                                class="px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500"
                            >
                                전송
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 멤버 목록 -->
            <div class="lg:col-span-1 bg-white rounded-lg shadow-md p-4">
                <h2 class="text-xl font-semibold mb-4 text-gray-700">멤버 목록</h2>
                <div class="space-y-3" id="member-list">
                    <!-- 멤버들이 여기에 동적으로 추가됩니다 -->
                </div>
            </div>
        </div>

        <!-- 테스트 정보 -->
        <div class="mt-8 bg-white rounded-lg shadow-md p-6">
            <h2 class="text-xl font-semibold mb-4 text-gray-700">테스트 기능</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="p-4 bg-blue-50 rounded-lg">
                    <h3 class="font-medium text-blue-900">채팅방 타입</h3>
                    <p class="text-sm text-blue-700 mt-1">
                        개인, 그룹, 공개, 팀 채팅방 구분
                    </p>
                </div>
                <div class="p-4 bg-green-50 rounded-lg">
                    <h3 class="font-medium text-green-900">메시지 타입</h3>
                    <p class="text-sm text-green-700 mt-1">
                        텍스트, 이미지, 파일, 시스템, 봇 메시지
                    </p>
                </div>
                <div class="p-4 bg-purple-50 rounded-lg">
                    <h3 class="font-medium text-purple-900">메시지 상태</h3>
                    <p class="text-sm text-purple-700 mt-1">
                        전송 중, 전송 완료, 전달됨, 읽음, 실패
                    </p>
                </div>
                <div class="p-4 bg-yellow-50 rounded-lg">
                    <h3 class="font-medium text-yellow-900">사용자 역할</h3>
                    <p class="text-sm text-yellow-700 mt-1">
                        관리자, 멤버, 게스트 권한 구분
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 더미 데이터
        const dummyRooms = [
            {
                id: '1',
                name: '개인 채팅방',
                description: '1:1 개인 대화',
                type: 'private',
                memberCount: 2,
                avatar: '💬',
                isPrivate: true,
                isActive: true,
            },
            {
                id: '2',
                name: '팀 프로젝트',
                description: '프로젝트 팀 채팅',
                type: 'team',
                memberCount: 5,
                avatar: '👥',
                isPrivate: false,
                isActive: true,
            },
            {
                id: '3',
                name: '공개 채널',
                description: '모든 사용자 참여 가능',
                type: 'public',
                memberCount: 15,
                avatar: '🌐',
                isPrivate: false,
                isActive: true,
            },
        ];

        const dummyMembers = [
            {
                userId: 'user1',
                username: '김철수',
                avatar: '👨',
                role: 'admin',
                isOnline: true,
                isDnd: false,
            },
            {
                userId: 'user2',
                username: '이영희',
                avatar: '👩',
                role: 'member',
                isOnline: true,
                isDnd: false,
            },
            {
                userId: 'user3',
                username: '박민수',
                avatar: '👨‍💼',
                role: 'member',
                isOnline: false,
                isDnd: false,
            },
        ];

        const dummyMessages = {
            '1': [
                {
                    id: '1',
                    senderId: 'user1',
                    senderName: '김철수',
                    content: '안녕하세요!',
                    type: 'text',
                    status: 'read',
                    timestamp: new Date(Date.now() - 60000),
                },
                {
                    id: '2',
                    senderId: 'user2',
                    senderName: '이영희',
                    content: '반갑습니다!',
                    type: 'text',
                    status: 'read',
                    timestamp: new Date(Date.now() - 30000),
                },
            ],
            '2': [
                {
                    id: '3',
                    senderId: 'user1',
                    senderName: '김철수',
                    content: '프로젝트 진행상황은 어떠신가요?',
                    type: 'text',
                    status: 'read',
                    timestamp: new Date(Date.now() - 120000),
                },
            ],
            '3': [
                {
                    id: '4',
                    senderId: 'user3',
                    senderName: '박민수',
                    content: '안녕하세요 여러분!',
                    type: 'text',
                    status: 'sent',
                    timestamp: new Date(Date.now() - 90000),
                },
            ],
        };

        let selectedRoom = null;
        let messageCounter = 100;

        // 채팅방 목록 렌더링
        function renderRooms() {
            const roomList = document.getElementById('room-list');
            roomList.innerHTML = '';

            dummyRooms.forEach(room => {
                const roomElement = document.createElement('div');
                roomElement.className = `p-3 rounded-lg cursor-pointer transition-colors room-card ${
                    selectedRoom?.id === room.id
                        ? 'bg-blue-100 border-blue-300'
                        : 'bg-gray-50 hover:bg-gray-100'
                }`;
                roomElement.onclick = () => selectRoom(room);

                roomElement.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 rounded-full bg-blue-500 flex items-center justify-center text-white">
                            ${room.avatar}
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3 class="font-medium text-gray-900 truncate">
                                ${room.name}
                            </h3>
                            <p class="text-sm text-gray-500 truncate">
                                ${room.description}
                            </p>
                            <div class="flex items-center space-x-2 mt-1">
                                <span class="px-2 py-1 text-xs rounded-full ${
                                    room.type === 'private' ? 'bg-purple-100 text-purple-800' :
                                    room.type === 'team' ? 'bg-blue-100 text-blue-800' :
                                    'bg-green-100 text-green-800'
                                }">
                                    ${room.type}
                                </span>
                                <span class="text-xs text-gray-400">
                                    ${room.memberCount}명
                                </span>
                            </div>
                        </div>
                    </div>
                `;

                roomList.appendChild(roomElement);
            });
        }

        // 채팅방 선택
        function selectRoom(room) {
            selectedRoom = room;
            renderRooms();
            renderChatHeader();
            renderMessages();
            renderMembers();
            showMessageInput();
        }

        // 채팅 헤더 렌더링
        function renderChatHeader() {
            const header = document.getElementById('chat-header');
            const roomName = document.getElementById('room-name');
            const roomInfo = document.getElementById('room-info');
            const roomType = document.getElementById('room-type');
            const roomAvatar = document.getElementById('room-avatar');

            roomName.textContent = selectedRoom.name;
            roomInfo.textContent = `${selectedRoom.memberCount}명 참여 중`;
            roomType.textContent = selectedRoom.type;
            roomAvatar.textContent = selectedRoom.avatar;

            header.style.display = 'block';
        }

        // 메시지 렌더링
        function renderMessages() {
            const container = document.getElementById('messages-container');
            const messages = dummyMessages[selectedRoom.id] || [];

            container.innerHTML = '';

            messages.forEach(message => {
                const messageElement = document.createElement('div');
                messageElement.className = `flex ${message.senderId === 'user1' ? 'justify-end' : 'justify-start'}`;

                const isSent = message.senderId === 'user1';
                const bubbleClass = isSent ? 'message-sent' : 'message-received';

                messageElement.innerHTML = `
                    <div class="message-bubble ${bubbleClass} px-4 py-2">
                        <div class="flex items-center space-x-2">
                            ${getTypeIcon(message.type)}
                            <span class="text-sm">${message.content}</span>
                        </div>
                        <div class="flex items-center justify-between mt-1 ${isSent ? 'text-blue-100' : 'text-gray-500'}">
                            <span class="text-xs">
                                ${message.timestamp.toLocaleTimeString()}
                            </span>
                            ${isSent ? `
                                <span class="text-xs ${getStatusColor(message.status)}">
                                    ${getStatusText(message.status)}
                                </span>
                            ` : ''}
                        </div>
                    </div>
                `;

                container.appendChild(messageElement);
            });

            container.scrollTop = container.scrollHeight;
        }

        // 멤버 목록 렌더링
        function renderMembers() {
            const memberList = document.getElementById('member-list');
            memberList.innerHTML = '';

            dummyMembers.forEach(member => {
                const memberElement = document.createElement('div');
                memberElement.className = 'flex items-center space-x-3';

                memberElement.innerHTML = `
                    <div class="relative">
                        <div class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center text-lg">
                            ${member.avatar}
                        </div>
                        ${member.isOnline ? '<div class="absolute -bottom-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-white"></div>' : ''}
                    </div>
                    <div class="flex-1">
                        <h3 class="font-medium text-gray-900">${member.username}</h3>
                        <div class="flex items-center space-x-2">
                            <span class="px-2 py-1 text-xs rounded-full ${
                                member.role === 'admin' ? 'bg-red-100 text-red-800' :
                                member.role === 'member' ? 'bg-blue-100 text-blue-800' :
                                'bg-gray-100 text-gray-800'
                            }">
                                ${member.role}
                            </span>
                            ${member.isDnd ? `
                                <span class="px-2 py-1 text-xs rounded-full bg-yellow-100 text-yellow-800">
                                    방해금지
                                </span>
                            ` : ''}
                        </div>
                    </div>
                `;

                memberList.appendChild(memberElement);
            });
        }

        // 메시지 입력 표시
        function showMessageInput() {
            document.getElementById('message-input').style.display = 'block';
        }

        // 메시지 전송
        function sendMessage() {
            const messageText = document.getElementById('message-text').value.trim();
            const messageType = document.getElementById('message-type').value;

            if (!messageText || !selectedRoom) return;

            const newMessage = {
                id: (++messageCounter).toString(),
                senderId: 'user1',
                senderName: '김철수',
                content: messageText,
                type: messageType,
                status: 'sending',
                timestamp: new Date(),
            };

            if (!dummyMessages[selectedRoom.id]) {
                dummyMessages[selectedRoom.id] = [];
            }
            dummyMessages[selectedRoom.id].push(newMessage);

            document.getElementById('message-text').value = '';
            renderMessages();

            // 시뮬레이션: 메시지 상태 업데이트
            setTimeout(() => {
                newMessage.status = 'sent';
                renderMessages();
            }, 1000);
        }

        // 메시지 타입 아이콘
        function getTypeIcon(type) {
            switch (type) {
                case 'image': return '🖼️';
                case 'file': return '📎';
                case 'system': return '🔔';
                case 'bot': return '🤖';
                default: return '';
            }
        }

        // 메시지 상태 색상
        function getStatusColor(status) {
            switch (status) {
                case 'sending': return 'text-gray-400';
                case 'sent': return 'text-blue-500';
                case 'delivered': return 'text-green-500';
                case 'read': return 'text-green-600';
                case 'failed': return 'text-red-500';
                default: return 'text-gray-400';
            }
        }

        // 메시지 상태 텍스트
        function getStatusText(status) {
            switch (status) {
                case 'sending': return '전송 중...';
                case 'sent': return '✓';
                case 'delivered': return '✓✓';
                case 'read': return '✓✓';
                case 'failed': return '✗';
                default: return '';
            }
        }

        // Enter 키로 메시지 전송
        document.getElementById('message-text').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // 초기화
        renderRooms();
        renderMembers();

        console.log('채팅 테스트 페이지가 로드되었습니다!');
    </script>
</body>
</html> 